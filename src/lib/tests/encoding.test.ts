import { describe, it, expect, test } from "vitest";
import { getEncodedItemVariant, unpackTuple } from "../utils";

describe("Encoding Utils", () => {
  describe("unpackTuple", () => {
    it("should return 0,0 for undefined or empty strings", () => {
      expect(unpackTuple(undefined)).toEqual({ variant: 0, pattern: 0 });
      expect(unpackTuple("")).toEqual({ variant: 0, pattern: 0 });
    });

    it("should unpack correctly formatted strings", () => {
      // Even though (0 23) is an invalid pattern, it should unpack nonetheless
      expect(unpackTuple("(0 23)")).toEqual({ variant: 0, pattern: 23 });
      expect(unpackTuple("(1 32)")).toEqual({ variant: 1, pattern: 32 });
    });
  });

  describe("getEncodedItemVariant", () => {
    it("should return only the hex if variations are 0", () => {
      expect(getEncodedItemVariant("32D2", 0, 0)).toBe("32D2");
    });

    test.each([
      ["38EF", 1, "00000001000038EF"],
      ["38EF", 2, "00000002000038EF"],
      ["38EF", 3, "00000003000038EF"],
      ["38EF", 4, "00000004000038EF"],
    ])("variation test: item %s, var %i -> %s", (item, variation, expected) => {
      expect(getEncodedItemVariant(item, variation)).toBe(expected);
    });

    test.each([
      // Iron Worktable 0x0DE8
      ["0DE8", 0, 0, "0DE8"],
      ["0DE8", 1, 0, "0000000100000DE8"],

      // Iron Hanger Stand 0x307A, 3 variations, 2 patterns
      ["0DE9", 0, 0, "0DE9"],
      ["0DE9", 0, 32, "0000002000000DE9"],
      ["0DE9", 1, 0, "0000000100000DE9"],
      ["0DE9", 1, 32, "0000002100000DE9"],

      // Wedding Welcome Board 0x307A, 3 variations, 2 patterns
      ["307A", 0, 0, "307A"],
      ["307A", 0, 32, "000000200000307A"],

      ["307A", 1, 0, "000000010000307A"],
      ["307A", 1, 32, "000000210000307A"],

      ["307A", 2, 0, "000000020000307A"],
      ["307A", 2, 32, "000000220000307A"],

      // Cool Sofa 0x32D2, 3 variations, 8 patterns
      ["32D2", 0, 0, "32D2"],
      ["32D2", 0, 32, "00000020000032D2"],
      ["32D2", 0, 64, "00000040000032D2"],
      ["32D2", 0, 96, "00000060000032D2"],
      ["32D2", 0, 128, "00000080000032D2"],
      ["32D2", 0, 160, "000000A0000032D2"],
      ["32D2", 0, 192, "000000C0000032D2"],
      ["32D2", 0, 224, "000000E0000032D2"],

      ["32D2", 1, 0, "00000001000032D2"],
      ["32D2", 1, 32, "00000021000032D2"],
      ["32D2", 1, 64, "00000041000032D2"],
      ["32D2", 1, 96, "00000061000032D2"],
      ["32D2", 1, 128, "00000081000032D2"],
      ["32D2", 1, 160, "000000A1000032D2"],
      ["32D2", 1, 192, "000000C1000032D2"],
      ["32D2", 1, 224, "000000E1000032D2"],

      ["32D2", 2, 0, "00000002000032D2"],
      ["32D2", 2, 32, "00000022000032D2"],
      ["32D2", 2, 64, "00000042000032D2"],
      ["32D2", 2, 96, "00000062000032D2"],
      ["32D2", 2, 128, "00000082000032D2"],
      ["32D2", 2, 160, "000000A2000032D2"],
      ["32D2", 2, 192, "000000C2000032D2"],
      ["32D2", 2, 224, "000000E2000032D2"],

      // Baby Bed 0x004F, 8 variations, 7 patterns
      ["004F", 0, 0, "004F"],
      ["004F", 0, 32, "000000200000004F"],
      ["004F", 0, 64, "000000400000004F"],
      ["004F", 0, 96, "000000600000004F"],
      ["004F", 0, 128, "000000800000004F"],
      ["004F", 0, 160, "000000A00000004F"],
      ["004F", 0, 192, "000000C00000004F"],

      ["004F", 1, 0, "000000010000004F"],
      ["004F", 1, 32, "000000210000004F"],
      ["004F", 1, 64, "000000410000004F"],
      ["004F", 1, 96, "000000610000004F"],
      ["004F", 1, 128, "000000810000004F"],
      ["004F", 1, 160, "000000A10000004F"],
      ["004F", 1, 192, "000000C10000004F"],

      ["004F", 2, 0, "000000020000004F"],
      ["004F", 2, 32, "000000220000004F"],
      ["004F", 2, 64, "000000420000004F"],
      ["004F", 2, 96, "000000620000004F"],
      ["004F", 2, 128, "000000820000004F"],
      ["004F", 2, 160, "000000A20000004F"],
      ["004F", 2, 192, "000000C20000004F"],

      ["004F", 3, 0, "000000030000004F"],
      ["004F", 3, 32, "000000230000004F"],
      ["004F", 3, 64, "000000430000004F"],
      ["004F", 3, 96, "000000630000004F"],
      ["004F", 3, 128, "000000830000004F"],
      ["004F", 3, 160, "000000A30000004F"],
      ["004F", 3, 192, "000000C30000004F"],

      ["004F", 4, 0, "000000040000004F"],
      ["004F", 4, 32, "000000240000004F"],
      ["004F", 4, 64, "000000440000004F"],
      ["004F", 4, 96, "000000640000004F"],
      ["004F", 4, 128, "000000840000004F"],
      ["004F", 4, 160, "000000A40000004F"],
      ["004F", 4, 192, "000000C40000004F"],

      ["004F", 5, 0, "000000050000004F"],
      ["004F", 5, 32, "000000250000004F"],
      ["004F", 5, 64, "000000450000004F"],
      ["004F", 5, 96, "000000650000004F"],
      ["004F", 5, 128, "000000850000004F"],
      ["004F", 5, 160, "000000A50000004F"],
      ["004F", 5, 192, "000000C50000004F"],

      ["004F", 6, 0, "000000060000004F"],
      ["004F", 6, 32, "000000260000004F"],
      ["004F", 6, 64, "000000460000004F"],
      ["004F", 6, 96, "000000660000004F"],
      ["004F", 6, 128, "000000860000004F"],
      ["004F", 6, 160, "000000A60000004F"],
      ["004F", 6, 192, "000000C60000004F"],

      ["004F", 7, 0, "000000070000004F"],
      ["004F", 7, 32, "000000270000004F"],
      ["004F", 7, 64, "000000470000004F"],
      ["004F", 7, 96, "000000670000004F"],
      ["004F", 7, 128, "000000870000004F"],
      ["004F", 7, 160, "000000A70000004F"],
      ["004F", 7, 192, "000000C70000004F"],

      // Changing Room 0x0718, 8 variations, 8 patterns.
      ["0718", 0, 0, "0718"],
      ["0718", 0, 32, "0000002000000718"],
      ["0718", 0, 64, "0000004000000718"],
      ["0718", 0, 96, "0000006000000718"],
      ["0718", 0, 128, "0000008000000718"],
      ["0718", 0, 160, "000000A000000718"],
      ["0718", 0, 192, "000000C000000718"],
      ["0718", 0, 224, "000000E000000718"],

      ["0718", 1, 0, "0000000100000718"],
      ["0718", 1, 32, "0000002100000718"],
      ["0718", 1, 64, "0000004100000718"],
      ["0718", 1, 96, "0000006100000718"],
      ["0718", 1, 128, "0000008100000718"],
      ["0718", 1, 160, "000000A100000718"],
      ["0718", 1, 192, "000000C100000718"],
      ["0718", 1, 224, "000000E100000718"],

      ["0718", 2, 0, "0000000200000718"],
      ["0718", 2, 32, "0000002200000718"],
      ["0718", 2, 64, "0000004200000718"],
      ["0718", 2, 96, "0000006200000718"],
      ["0718", 2, 128, "0000008200000718"],
      ["0718", 2, 160, "000000A200000718"],
      ["0718", 2, 192, "000000C200000718"],
      ["0718", 2, 224, "000000E200000718"],

      ["0718", 3, 0, "0000000300000718"],
      ["0718", 3, 32, "0000002300000718"],
      ["0718", 3, 64, "0000004300000718"],
      ["0718", 3, 96, "0000006300000718"],
      ["0718", 3, 128, "0000008300000718"],
      ["0718", 3, 160, "000000A300000718"],
      ["0718", 3, 192, "000000C300000718"],
      ["0718", 3, 224, "000000E300000718"],

      ["0718", 4, 0, "0000000400000718"],
      ["0718", 4, 32, "0000002400000718"],
      ["0718", 4, 64, "0000004400000718"],
      ["0718", 4, 96, "0000006400000718"],
      ["0718", 4, 128, "0000008400000718"],
      ["0718", 4, 160, "000000A400000718"],
      ["0718", 4, 192, "000000C400000718"],
      ["0718", 4, 224, "000000E400000718"],

      ["0718", 5, 0, "0000000500000718"],
      ["0718", 5, 32, "0000002500000718"],
      ["0718", 5, 64, "0000004500000718"],
      ["0718", 5, 96, "0000006500000718"],
      ["0718", 5, 128, "0000008500000718"],
      ["0718", 5, 160, "000000A500000718"],
      ["0718", 5, 192, "000000C500000718"],
      ["0718", 5, 224, "000000E500000718"],

      ["0718", 6, 0, "0000000600000718"],
      ["0718", 6, 32, "0000002600000718"],
      ["0718", 6, 64, "0000004600000718"],
      ["0718", 6, 96, "0000006600000718"],
      ["0718", 6, 128, "0000008600000718"],
      ["0718", 6, 160, "000000A600000718"],
      ["0718", 6, 192, "000000C600000718"],
      ["0718", 6, 224, "000000E600000718"],

      ["0718", 7, 0, "0000000700000718"],
      ["0718", 7, 32, "0000002700000718"],
      ["0718", 7, 64, "0000004700000718"],
      ["0718", 7, 96, "0000006700000718"],
      ["0718", 7, 128, "0000008700000718"],
      ["0718", 7, 160, "000000A700000718"],
      ["0718", 7, 192, "000000C700000718"],
      ["0718", 7, 224, "000000E700000718"],

      // Drum Set 0x070B, 8 variations, 6 patterns.
      ["070B", 0, 0, "070B"],
      ["070B", 0, 32, "000000200000070B"],
      ["070B", 0, 64, "000000400000070B"],
      ["070B", 0, 96, "000000600000070B"],
      ["070B", 0, 128, "000000800000070B"],
      ["070B", 0, 160, "000000A00000070B"],

      ["070B", 1, 0, "000000010000070B"],
      ["070B", 1, 32, "000000210000070B"],
      ["070B", 1, 64, "000000410000070B"],
      ["070B", 1, 96, "000000610000070B"],
      ["070B", 1, 128, "000000810000070B"],
      ["070B", 1, 160, "000000A10000070B"],

      ["070B", 2, 0, "000000020000070B"],
      ["070B", 2, 32, "000000220000070B"],
      ["070B", 2, 64, "000000420000070B"],
      ["070B", 2, 96, "000000620000070B"],
      ["070B", 2, 128, "000000820000070B"],
      ["070B", 2, 160, "000000A20000070B"],

      ["070B", 3, 0, "000000030000070B"],
      ["070B", 3, 32, "000000230000070B"],
      ["070B", 3, 64, "000000430000070B"],
      ["070B", 3, 96, "000000630000070B"],
      ["070B", 3, 128, "000000830000070B"],
      ["070B", 3, 160, "000000A30000070B"],

      ["070B", 4, 0, "000000040000070B"],
      ["070B", 4, 32, "000000240000070B"],
      ["070B", 4, 64, "000000440000070B"],
      ["070B", 4, 96, "000000640000070B"],
      ["070B", 4, 128, "000000840000070B"],
      ["070B", 4, 160, "000000A40000070B"],

      ["070B", 5, 0, "000000050000070B"],
      ["070B", 5, 32, "000000250000070B"],
      ["070B", 5, 64, "000000450000070B"],
      ["070B", 5, 96, "000000650000070B"],
      ["070B", 5, 128, "000000850000070B"],
      ["070B", 5, 160, "000000A50000070B"],

      ["070B", 6, 0, "000000060000070B"],
      ["070B", 6, 32, "000000260000070B"],
      ["070B", 6, 64, "000000460000070B"],
      ["070B", 6, 96, "000000660000070B"],
      ["070B", 6, 128, "000000860000070B"],
      ["070B", 6, 160, "000000A60000070B"],

      ["070B", 7, 0, "000000070000070B"],
      ["070B", 7, 32, "000000270000070B"],
      ["070B", 7, 64, "000000470000070B"],
      ["070B", 7, 96, "000000670000070B"],
      ["070B", 7, 128, "000000870000070B"],
      ["070B", 7, 160, "000000A70000070B"],
    ])(
      "double variation: %s, var %i, pat %i -> %s",
      (item, variation, pattern, expected) => {
        expect(getEncodedItemVariant(item, variation, pattern)).toBe(expected);
      },
    );

    it("should throw error for invalid secondary var", () => {
      expect(() => getEncodedItemVariant("32D2", 1, 2)).toThrow();
    });
  });
});
